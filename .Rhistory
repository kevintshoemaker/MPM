prev=prev+t$dur[s]
}
} # end if no variable-age stages
agedf[,survnames]
agedf[,survnames]*agedf[,stnames]
rowSums( agedf[,survnames]*agedf[,stnames] )
f
adstage
agedf[,adstage]
agedf[,adstage]
agedf$surv = rowSums( agedf[,survnames]*agedf[,stnames] )   # survival by age
agedf$f = agedf[,adstage] * f * fys
m0
m0[2:na,1:(na-1)] = m1
m1 <- diag(agedf$surv)
m0[2:na,1:(na-1)] = m1
m1 <- diag(agedf$surv)
m1
m1 <- diag(tail(agedf$surv,nrow(agedf)-1))
m1
m0[2:na,1:(na-1)] = m1
m1 <- diag(tail(agedf$surv,nrow(agedf)-1))
m0[2:na,1:(na-1)] = m1
dim(m1)
dim(m0)
tail(agedf$surv,nrow(agedf)-1)
agedf$surv
na
m1 <- diag(agedf$surv[agedf$age%in%c(1:(na-1))])
dim(m1)
m1 <- diag(agedf$surv[agedf$age%in%c(1:(na-1))])
m0[2:na,1:(na-1)] = m1
# m0[1,1:(na-1)] = agedf$f
m0
agedf$f
m0
m0[1,] = agedf$f
1:(na-1)
agedf$f[-1]
m0[1,] = agedf$f[-1]
m0
init_input_check(fys,js,as,f,t)
na = sum(t[[ncol(t)]])+1; ns = nrow(t)   # na is number of age classes, ns is number of juv stage classes
m0 <- matrix(0,na,na) ;  m0[1,na] <- f*fys;  m0[na,na] <- as    # construct init matrix
stnames = paste0("st_", 0:(ns+1))   # kts added zero age/stage for completeness
survnames = paste0("surv_", 0:(ns+1))
fystage = stnames[1]
do_unroll <- function(fys,js,as,f,t){
init_input_check(fys,js,as,f,t)
na = sum(t[[ncol(t)]])+1; ns = nrow(t)   # na is number of age classes, ns is number of juv stage classes
m0 <- matrix(0,na,na) ;  m0[1,na] <- f*fys;  m0[na,na] <- as    # construct init matrix
stnames = paste0("st_", 0:(ns+1))   # kts added zero age/stage for completeness [but actually probably should take it out again to simplify]
survnames = paste0("surv_", 0:(ns+1))
fystage = stnames[1]
adstage = stnames[ns+2]
juvstages = setdiff(stnames,c(fystage,adstage))
agedf = data.frame(    # make data frame to do preliminary computations
age = 0:na
)
agedf[stnames] <- lapply(1:(ns+1), function(x) 0)  # add cols for fraction in stage by age
agedf[survnames] <- lapply(1:(ns+1), function(x) 0)  # add cols for survival of each stage by age
agedf$st_0[1] = 1; agedf$st_1[2] = 1   # set all newborns in stage zero, and temporarily set all age 1 individuals in stage 1.
agedf[[survnames[1]]] = fys     # set first and last survival rates
agedf[[tail(survnames,1)]] = as
s=1
for(s in 1:ns){
thisst = juvstages[s]; thissurv=gsub("st_","surv_",thisst)
# fill in survival for juvenile stages
if(ncol(js)>1){  # if survival ramp
ss = c(fys,js$mean,as)   # put together all the survival rates for all stages
names(ss) = stnames
startage = ifelse(s==1,1,cumsum(t$dur[1:s])+1)
theseages = startage:(startage+t$dur[s]-1)
thisramp = ramp_fun(
js$mean[s],
ifelse(is.na(js$min[s]),ss[s],js$min[s]),
ss[s+2],
t$dur[s]+ifelse(is.na(js$min[s]),2,1),
include_first = !is.na(js$min[s])
)
agedf[[thissurv]][agedf$age%in%theseages] = thisramp
agedf[[thissurv]][agedf$age<min(theseages)] = thisramp[1]
agedf[[thissurv]][agedf$age>max(theseages)] = tail(thisramp,1)
}else{   # if not ramp
agedf[[thissurv]]=js$mean[s]
}
}  # end loop through stages
# fill in stage probabilities by age for juvenile stages
if(ncol(t)>1){
td = lapply(1:nrow(t),function(z) vari_dur(t[z,1],t[z,2],t[z,3] )   )  # variable ages at transition
j=2
for(j in 1:ns){   # determine probability densities of transitioning at each age given variable durations
thiscol = stnames[1+j]
nextcol = stnames[1+j+1]
thistd = td[[j]]
if(j==1){
agedf[[nextcol]][match(thistd$dur,agedf$age-1)] = thistd$prob
}else{
nonzero_ages = agedf$age[agedf[[thiscol]]>1e-15 ]
a=2
for(a in 1:length(nonzero_ages)){  # loop through all ages of the prior stage and redistribute them
thisa = nonzero_ages[a]
agedf[[nextcol]][agedf$age%in%(thisa+thistd$dur)] = agedf[[nextcol]][agedf$age%in%(thisa+thistd$dur)] +
agedf[[thiscol]][agedf$age==thisa] * thistd$prob
}
}
}# end loop through stages
colSums(agedf[,stnames])   # make sure cols sum to 1...
stprob = agedf[,stnames]
stprob$st_1[agedf$age>0] = 1  # start with everyone in first stage
s=1
for(s in 1:ns){
start = stprob[,s+1]   # all who did not transition to the next stage stay
pstay = pmax(0,pmin(1,1-cumsum(agedf[,sprintf("st_%s",s+1)])))
stprob[,s+1] = start * pstay   # need to be in stage currently AND stay in stage
stprob[,s+2] = start * (1 - pstay)
}
rowSums(stprob)   # make sure rows sum to 1
agedf[,stnames] = stprob
}else{  # if no variable-age stages
prev=2; s=1
for(s in 1:ns){
agedf[prev:(prev+t$dur[s]-1),juvstages[s]] = 1
prev=prev+t$dur[s]
}
} # end if no variable-age stages
agedf$surv = rowSums( agedf[,survnames]*agedf[,stnames] )   # survival by age
agedf$f = agedf[,adstage] * f * fys   # check this- not sure this is right! Maybe only let adult stage have potential fertility
m1 <- diag(agedf$surv[agedf$age%in%c(1:(na-1))])
m0[2:na,1:(na-1)] = m1
m0[1,] = agedf$f[-1]
m0
}
fys=scen1$fysurv; js=scen1$jsurv;as=scen1$asurv;f=scen1$fec;t=scen1$dur
mat <- do_aas(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)    # AAS
mat
lambda(mat)
mat <- do_unroll(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)   # unroll
mat
lambda(mat)       # gives the same result as AAS- as it should!
fys=scen1$fysurv; js=scen1$jsurv;as=scen1$asurv;f=scen1$fec;t=scen1$dur
mat <- do_aas(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)    # AAS
mat
lambda(mat)
fys=scen1$fysurv
mat <- do_unroll(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)   # unroll
mat
init_input_check(fys,js,as,f,t)
na = sum(t[[ncol(t)]])+1; ns = nrow(t)   # na is number of age classes, ns is number of juv stage classes
m0 <- matrix(0,na,na) ;  m0[1,na] <- f*fys;  m0[na,na] <- as    # construct init matrix
stnames = paste0("st_", 0:(ns+1))   # kts added zero age/stage for completeness [but actually probably should take it out again to simplify]
survnames = paste0("surv_", 0:(ns+1))
fystage = stnames[1]
m0
m0 <- matrix(0,na,na) ;  m0[1,na] <- f*fys;  m0[na,na] <- as    # construct init matrix
stnames = paste0("st_", 0:(ns+1))   # kts added zero age/stage for completeness [but actually probably should take it out again to simplify]
survnames = paste0("surv_", 0:(ns+1))
fystage = stnames[1]
adstage = stnames[ns+2]
juvstages = setdiff(stnames,c(fystage,adstage))
agedf = data.frame(    # make data frame to do preliminary computations
age = 0:na
)
agedf[stnames] <- lapply(1:(ns+1), function(x) 0)  # add cols for fraction in stage by age
agedf[survnames] <- lapply(1:(ns+1), function(x) 0)  # add cols for survival of each stage by age
agedf$st_0[1] = 1; agedf$st_1[2] = 1   # set all newborns in stage zero, and temporarily set all age 1 individuals in stage 1.
agedf[[survnames[1]]] = fys     # set first and last survival rates
agedf[[tail(survnames,1)]] = as
s=1
for(s in 1:ns){
thisst = juvstages[s]; thissurv=gsub("st_","surv_",thisst)
# fill in survival for juvenile stages
if(ncol(js)>1){  # if survival ramp
ss = c(fys,js$mean,as)   # put together all the survival rates for all stages
names(ss) = stnames
startage = ifelse(s==1,1,cumsum(t$dur[1:s])+1)
theseages = startage:(startage+t$dur[s]-1)
thisramp = ramp_fun(
js$mean[s],
ifelse(is.na(js$min[s]),ss[s],js$min[s]),
ss[s+2],
t$dur[s]+ifelse(is.na(js$min[s]),2,1),
include_first = !is.na(js$min[s])
)
agedf[[thissurv]][agedf$age%in%theseages] = thisramp
agedf[[thissurv]][agedf$age<min(theseages)] = thisramp[1]
agedf[[thissurv]][agedf$age>max(theseages)] = tail(thisramp,1)
}else{   # if not ramp
agedf[[thissurv]]=js$mean[s]
}
}  # end loop through stages
# fill in stage probabilities by age for juvenile stages
if(ncol(t)>1){
td = lapply(1:nrow(t),function(z) vari_dur(t[z,1],t[z,2],t[z,3] )   )  # variable ages at transition
j=2
for(j in 1:ns){   # determine probability densities of transitioning at each age given variable durations
thiscol = stnames[1+j]
nextcol = stnames[1+j+1]
thistd = td[[j]]
if(j==1){
agedf[[nextcol]][match(thistd$dur,agedf$age-1)] = thistd$prob
}else{
nonzero_ages = agedf$age[agedf[[thiscol]]>1e-15 ]
a=2
for(a in 1:length(nonzero_ages)){  # loop through all ages of the prior stage and redistribute them
thisa = nonzero_ages[a]
agedf[[nextcol]][agedf$age%in%(thisa+thistd$dur)] = agedf[[nextcol]][agedf$age%in%(thisa+thistd$dur)] +
agedf[[thiscol]][agedf$age==thisa] * thistd$prob
}
}
}# end loop through stages
colSums(agedf[,stnames])   # make sure cols sum to 1...
stprob = agedf[,stnames]
stprob$st_1[agedf$age>0] = 1  # start with everyone in first stage
s=1
for(s in 1:ns){
start = stprob[,s+1]   # all who did not transition to the next stage stay
pstay = pmax(0,pmin(1,1-cumsum(agedf[,sprintf("st_%s",s+1)])))
stprob[,s+1] = start * pstay   # need to be in stage currently AND stay in stage
stprob[,s+2] = start * (1 - pstay)
}
rowSums(stprob)   # make sure rows sum to 1
agedf[,stnames] = stprob
}else{  # if no variable-age stages
prev=2; s=1
for(s in 1:ns){
agedf[prev:(prev+t$dur[s]-1),juvstages[s]] = 1
prev=prev+t$dur[s]
}
} # end if no variable-age stages
agedf[[adstage]]
nrow(agedf)
agedf[[adstage]][nrow(agedf)] = 1
agedf$surv = rowSums( agedf[,survnames]*agedf[,stnames] )   # survival by age
agedf$f = agedf[,adstage] * f * fys   # check this- not sure this is right! Maybe only let adult stage have potential fertility
m1 <- diag(agedf$surv[agedf$age%in%c(1:(na-1))])
m0[2:na,1:(na-1)] = m1
m0[1,] = agedf$f[-1]
m0
do_unroll <- function(fys,js,as,f,t){
init_input_check(fys,js,as,f,t)
na = sum(t[[ncol(t)]])+1; ns = nrow(t)   # na is number of age classes, ns is number of juv stage classes
m0 <- matrix(0,na,na) ;  m0[na,na] <- as    # construct init matrix
stnames = paste0("st_", 0:(ns+1))   # kts added zero age/stage for completeness [but actually probably should take it out again to simplify]
survnames = paste0("surv_", 0:(ns+1))
fystage = stnames[1]
adstage = stnames[ns+2]
juvstages = setdiff(stnames,c(fystage,adstage))
agedf = data.frame(    # make data frame to do preliminary computations
age = 0:na
)
agedf[stnames] <- lapply(1:(ns+1), function(x) 0)  # add cols for fraction in stage by age
agedf[survnames] <- lapply(1:(ns+1), function(x) 0)  # add cols for survival of each stage by age
agedf$st_0[1] = 1; agedf$st_1[2] = 1   # set all newborns in stage zero, and temporarily set all age 1 individuals in stage 1.
agedf[[survnames[1]]] = fys     # set first and last survival rates
agedf[[tail(survnames,1)]] = as
s=1
for(s in 1:ns){
thisst = juvstages[s]; thissurv=gsub("st_","surv_",thisst)
# fill in survival for juvenile stages
if(ncol(js)>1){  # if survival ramp
ss = c(fys,js$mean,as)   # put together all the survival rates for all stages
names(ss) = stnames
startage = ifelse(s==1,1,cumsum(t$dur[1:s])+1)
theseages = startage:(startage+t$dur[s]-1)
thisramp = ramp_fun(
js$mean[s],
ifelse(is.na(js$min[s]),ss[s],js$min[s]),
ss[s+2],
t$dur[s]+ifelse(is.na(js$min[s]),2,1),
include_first = !is.na(js$min[s])
)
agedf[[thissurv]][agedf$age%in%theseages] = thisramp
agedf[[thissurv]][agedf$age<min(theseages)] = thisramp[1]
agedf[[thissurv]][agedf$age>max(theseages)] = tail(thisramp,1)
}else{   # if not ramp
agedf[[thissurv]]=js$mean[s]
}
}  # end loop through stages
# fill in stage probabilities by age for juvenile stages
if(ncol(t)>1){
td = lapply(1:nrow(t),function(z) vari_dur(t[z,1],t[z,2],t[z,3] )   )  # variable ages at transition
j=2
for(j in 1:ns){   # determine probability densities of transitioning at each age given variable durations
thiscol = stnames[1+j]
nextcol = stnames[1+j+1]
thistd = td[[j]]
if(j==1){
agedf[[nextcol]][match(thistd$dur,agedf$age-1)] = thistd$prob
}else{
nonzero_ages = agedf$age[agedf[[thiscol]]>1e-15 ]
a=2
for(a in 1:length(nonzero_ages)){  # loop through all ages of the prior stage and redistribute them
thisa = nonzero_ages[a]
agedf[[nextcol]][agedf$age%in%(thisa+thistd$dur)] = agedf[[nextcol]][agedf$age%in%(thisa+thistd$dur)] +
agedf[[thiscol]][agedf$age==thisa] * thistd$prob
}
}
}# end loop through stages
colSums(agedf[,stnames])   # make sure cols sum to 1...
stprob = agedf[,stnames]
stprob$st_1[agedf$age>0] = 1  # start with everyone in first stage
s=1
for(s in 1:ns){
start = stprob[,s+1]   # all who did not transition to the next stage stay
pstay = pmax(0,pmin(1,1-cumsum(agedf[,sprintf("st_%s",s+1)])))
stprob[,s+1] = start * pstay   # need to be in stage currently AND stay in stage
stprob[,s+2] = start * (1 - pstay)
}
rowSums(stprob)   # make sure rows sum to 1
agedf[,stnames] = stprob
}else{  # if no variable-age stages
prev=2; s=1
for(s in 1:ns){
agedf[prev:(prev+t$dur[s]-1),juvstages[s]] = 1
prev=prev+t$dur[s]
}
agedf[[adstage]][nrow(agedf)] = 1
} # end if no variable-age stages
agedf$surv = rowSums( agedf[,survnames]*agedf[,stnames] )   # survival by age
agedf$f = agedf[,adstage] * f * fys   # check this- not sure this is right! Maybe only let adult stage have potential fertility
m1 <- diag(agedf$surv[agedf$age%in%c(1:(na-1))])
m0[2:na,1:(na-1)] = m1
m0[1,] = agedf$f[-1]
m0
}
fys=scen1$fysurv; js=scen1$jsurv;as=scen1$asurv;f=scen1$fec;t=scen1$dur
mat <- do_aas(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)    # AAS
mat
lambda(mat)
mat <- do_unroll(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)   # unroll
mat
lambda(mat)       # gives the same result as AAS- as it should!
mat <- do_aas(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)    # AAS
mat
lambda(mat)
mat <- do_unroll(fys=scen1$fysurv,js=scen1$jsurv,as=scen1$asurv,f=scen1$fec,t=scen1$dur)   # unroll
mat
lambda(mat)       # gives the same result as AAS- as it should!
mat <- do_fas(scen1$fysurv,scen1$jsurv,scen1$asurv,scen1$fec,scen1$dur)  # FAS
mat
lambda(mat)  # 1.065  --- 6.5% growth rate per year   - much higher growth rate!!!
js=scen2$jsurv;as=scen2$asurv;f=scen2$fec;t=scen2$dur
js
mat <- do_aas(scen2$jsurv,scen2$asurv,scen2$fec,scen2$dur)    # AAS
fys=scen2$fysurv; js=scen2$jsurv;as=scen2$asurv;f=scen2$fec;t=scen2$dur
mat <- do_aas(scen2$fysurv,scen2$jsurv,scen2$asurv,scen2$fec,scen2$dur)    # AAS
mat
lambda(mat)
mat <- do_unroll(scen2$jsurv,scen2$asurv,scen2$fec,scen2$dur)   # unroll
mat <- do_unroll(scen2$fysurv,scen2$jsurv,scen2$asurv,scen2$fec,scen2$dur)   # unroll
mat
lambda(mat)       # gives the same result as AAS- as it should!
mat <- do_fas(scen2$jsurv,scen2$asurv,scen2$fec,scen2$dur)  # FAS
mat
lambda(mat)  # still higher- but not quite as wrong
mat <- do_fas(scen2$fysurv,scen2$jsurv,scen2$asurv,scen2$fec,scen2$dur)  # FAS
mat
lambda(mat)  # still higher- but not quite as wrong
# scen3
fys=scen3$fysurv; js=scen3$jsurv; as=scen3$asurv; f=scen3$fec; t=scen3$dur
# scen3
fys=scen3$fysurv; js=scen3$jsurv; as=scen3$asurv; f=scen3$fec; t=scen3$dur
mat <- do_aas(scen3$fysurv,scen3$jsurv,scen3$asurv,scen3$fec,scen3$dur)   # aas- gives warning message (assumes fixed duration)
mat
lambda(mat)
mat <- do_unroll(scen3$fysurv,scen3$jsurv,scen3$asurv,scen3$fec,scen3$dur)   # very minor difference from fixed duration
mat
lambda(mat)
mat <- do_aas(scen3$fysurv,scen3$jsurv,scen3$asurv,scen3$fec,scen3$dur)   # aas- gives warning message (assumes fixed duration)
mat
lambda(mat)
# scen4
fys=scen4$fysurv; js=scen4$jsurv;as=scen4$asurv;f=scen4$fec;t=scen4$dur
mat <- do_unroll(scen4$fysurv,scen4$jsurv,scen4$asurv,scen4$fec,scen4$dur)
mat
lambda(mat)
# scen5
fys=scen5$fysurv; js=scen5$jsurv;as=scen5$asurv;f=scen5$fec;t=scen5$dur
mat <- do_unroll(scen5$fysurv,scen5$jsurv,scen5$asurv,scen5$fec,scen5$dur)
mat
scen5$jsurv
fys=scen6$fysurv; js=scen6$jsurv;as=scen6$asurv;f=scen6$fec;t=scen6$dur
fys=scen6$fysurv; js=scen6$jsurv;as=scen6$asurv;f=scen6$fec;t=scen6$dur
mat <- do_unroll(scen6$fysurv,scen6$jsurv,scen6$asurv,scen6$fec,scen6$dur)
mat
fys=scen7$fysurv; js=scen7$jsurv; as=scen7$asurv; f=scen7$fec; t=scen7$dur
mat <- do_unroll(scen7$fysurv,scen6$jsurv,scen6$asurv,scen6$fec,scen6$dur)
mat
fys=scen7$fysurv; js=scen7$jsurv; as=scen7$asurv; f=scen7$fec; t=scen7$dur
mat <- do_unroll(scen7$fysurv,scen7$jsurv,scen7$asurv,scen7$fec,scen7$dur)
mat
lambda(mat)
scen7$jsurv
scen8$jsurv
fys=scen7$fysurv; js=scen7$jsurv; as=scen7$asurv; f=scen7$fec; t=scen7$dur
mat <- do_unroll(scen7$fysurv,scen7$jsurv,scen7$asurv,scen7$fec,scen7$dur)
mat
lambda(mat)
fys=scen8$fysurv; js=scen8$jsurv; as=scen8$asurv; f=scen8$fec; t=scen8$dur
mat <- do_unroll(scen8$fysurv,scen8$jsurv,scen8$asurv,scen8$fec,scen8$dur)
mat
fys=scen9$fysurv; js=scen9$jsurv; as=scen9$asurv; f=scen9$fec; t=scen9$dur
mat <- do_unroll(scen9$fysurv,scen9$jsurv,scen9$asurv,scen9$fec,scen9$dur)
scen9$jsurv
gen_scen <- function(fysurv,jsurv,asurv,fec,dur,ramp){
if(is.vector(dur)) dur = data.frame(dur=dur)
nst = length(jsurv) + 1
if(is.vector(jsurv)){
if(ramp){
jsurv = data.frame(mean=jsurv,min=as.numeric(NA))   # the NA means that the ramp by default starts at the previous max value
}else{
jsurv = data.frame(mean=jsurv)
}
}
scen <- list()
scen$fysurv = fysurv
scen$jsurv = jsurv
scen$asurv = asurv
scen$fec = fec  # annual fecundity (assume pre-breeding census- this represents the number of new one-year-olds entering the population next year)
scen$dur = dur  # duration of juvenile stage (mean, min, max)
scen
}
scen9 <- gen_scen(    # if no min value specified for stage, assume the ramp starts at the previous value.
fysurv=0.45,
jsurv=c(0.6,0.8),
asurv=0.95,
fec=2.29,
dur=data.frame(
dur=c(3,5),
min=c(1,3),
max=c(3,8)
),
ramp=T
)
fys=scen9$fysurv; js=scen9$jsurv; as=scen9$asurv; f=scen9$fec; t=scen9$dur
mat <- do_unroll(scen9$fysurv,scen9$jsurv,scen9$asurv,scen9$fec,scen9$dur)
mat
rm(list=ls())
source("MPM_Functions_v0_2.R")
#scenario: age at maturity is 14 with a range of +/- 2.
#expectation: reproduction starts at age 12, experiences largest jump from 13 to 14, and is 1.0 (with adult survival rate) at age 16
#incorrect matrix when using "durations" of age-1 for the dur dataframe
scen <- gen_scen(# variable stage duration
fysurv=0.5,
jsurv=c(0.75),
asurv=0.96,
fec=2,
dur=data.frame(dur=14,min=12,max=16)
)
#scenario: age at maturity is 14 with a range of +/- 2.
#expectation: reproduction starts at age 12, experiences largest jump from 13 to 14, and is 1.0 (with adult survival rate) at age 16
#incorrect matrix when using "durations" of age-1 for the dur dataframe
scen <- gen_scen(# variable stage duration
fysurv=0.5,
jsurv=c(0.75),
asurv=0.96,
fec=2,
dur=data.frame(dur=14,min=12,max=16),
ramp=F
)
scen
mat <- do_unroll(scen$fysurv,scen$jsurv,scen$asurv,scen$fec,scen$dur)
mat
plot(1:ncol(mat),mat[1,],type="s")
abline(v=c(13,15,17),lt="dotted")
#correct matrix when using "durations" one longer htan intended
scen <- gen_scen(
fysurv = 0.5,
jsurv=c(0.75),
asurv=0.96,
fec=2,
dur=data.frame(dur=15,min=13,max=17)
)
#correct matrix when using "durations" one longer htan intended
scen <- gen_scen(
fysurv = 0.5,
jsurv=c(0.75),
asurv=0.96,
fec=2,
dur=data.frame(dur=15,min=13,max=17),
ramp=F
)
mat <- do_unroll(scen$jsurv,scen$asurv,scen$fec,scen$dur)
mat <- do_unroll(scen$fysurv, scen$jsurv,scen$asurv,scen$fec,scen$dur)
mat
source("MPM_Functions_v0_1.R")
#scenario: age at maturity is 15 with a range of +/- 2.
#expectation: reproduction starts at age 13, experiences largest jump from 14 to 15, and is 1.0 (with adult survival rate) at age 17
#incorrect matrix when using "durations" of age-1 for the dur dataframe
scen <- gen_scen(jsurv=c(0.75),asurv=0.96,fec=1,dur=data.frame(dur=14,min=12,max=16))   # variable stage duration
mat <- do_unroll(scen$jsurv,scen$asurv,scen$fec,scen$dur)
mat
plot(1:ncol(mat),mat[1,],type="s")
abline(v=c(13,15,17),lt="dotted")
source("MPM_Functions_v0_2.R")
#scenario: age at maturity is 14 with a range of +/- 2.
#expectation: reproduction starts at age 12, experiences largest jump from 13 to 14, and is 1.0 (with adult survival rate) at age 16
#incorrect matrix when using "durations" of age-1 for the dur dataframe
scen <- gen_scen(# variable stage duration
fysurv=0.5,
jsurv=c(0.75),
asurv=0.96,
fec=2,
dur=data.frame(dur=14,min=12,max=16),
ramp=F
)
mat <- do_unroll(scen$fysurv,scen$jsurv,scen$asurv,scen$fec,scen$dur)
mat
plot(1:ncol(mat),mat[1,],type="s")
abline(v=c(13,15,17),lt="dotted")
mat
